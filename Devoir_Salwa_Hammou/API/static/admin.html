<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<div id="app"></div>
<script type="text/babel" data-presets="react" data-type="module">
  import React from "https://esm.sh/react@18";
  import ReactDOM from "https://esm.sh/react-dom@18";

  function App() {
    const [articles, setArticles] = React.useState([]); // Liste des articles
    const [title, setTitle] = React.useState(""); // Titre de l'article
    const [content, setContent] = React.useState(""); // Contenu de l'article
    const [selectedArticleId, setSelectedArticleId] = React.useState(null); // ID de l'article à modifier

    // Fonction pour récupérer les articles depuis l'API
    async function fetchTitlesArticle() {
      const res = await fetch("/articles");
      const json = await res.json();
      setArticles(json); // Met à jour la liste des articles
    }

    // Fonction pour ajouter un nouvel article
    async function create_article() {
      const res = await fetch("/articles/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          title: title,
          content: content,
        }),
      });
      if (res.ok) {
        fetchTitlesArticle(); // Recharge les articles après ajout
        setTitle(""); // Réinitialise le titre
        setContent(""); // Réinitialise le contenu
      } else {
        console.error("Erreur lors de l'ajout de l'article");
      }
    }

    // Fonction pour sélectionner un article à modifier
    function select_article_to_edit(article) {
      setTitle(article.title);
      setContent(article.content);
      setSelectedArticleId(article.id);
    }

    // Fonction pour mettre à jour un article
    async function update_article() {
      const res = await fetch(`/articles/${selectedArticleId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          title: title,
          content: content,
        }),
      });

      if (res.ok) {
        fetchTitlesArticle(); // Recharge les articles après mise à jour
        reset_form(); // Réinitialise le formulaire
      } else {
        console.error("Erreur lors de la mise à jour de l'article");
      }
    }

    // Fonction pour supprimer un article
    async function delete_article(articleId) {
      const res = await fetch(`/articles/${articleId}`, {
        method: "DELETE",
      });

      if (res.ok) {
        fetchTitlesArticle(); // Recharge les articles après suppression
      } else {
        console.error("Erreur lors de la suppression");
      }
    }

    // Réinitialise le formulaire
    function reset_form() {
      setSelectedArticleId(null);
      setTitle("");
      setContent("");
    }

    // Charge les articles à l'initialisation
    React.useEffect(() => {
      fetchTitlesArticle();
    }, []);

    return (
      <div>
        <h1>Modifier, ajouter ou supprimer des articles</h1>
        <div>
          <h2>Liste des articles présents</h2>
          <ul>
            {articles.map((article) => (
              <li key={article.id}>
                <strong>{article.title}</strong>
                <button onClick={() => delete_article(article.id)}>Supprimer</button>
                <button onClick={() => select_article_to_edit(article)}>Modifier</button>
              </li>
            ))}
          </ul>
        </div>

        <div>
          <h2>{selectedArticleId ? "Modifier un article" : "Ajouter un nouvel article"}</h2>
          <input
            value={title}
            onInput={(e) => setTitle(e.target.value)}
            placeholder="Titre"
          />
          <input
            value={content}
            onInput={(e) => setContent(e.target.value)}
            placeholder="Contenu"
          />
          {selectedArticleId ? (
            <div>
              <button onClick={update_article}>Mettre à jour l'article</button>
              <button onClick={reset_form}>Annuler</button>
            </div>
          ) : (
            <button onClick={create_article}>Ajouter cet article</button>
          )}
        </div>
      </div>
    );
  }

  const appContainer = document.getElementById("app");
  ReactDOM.createRoot(appContainer).render(<App />);
</script>
